# PSO_DNR_Project
# 配电网重构实验全流程：基于 pandapower+PSO（含光伏 DG 场景）
## 一、问题背景（贴近实际工程场景）
**1. 场景设定**
+ 某城市 10kV 配电网采用IEEE 33 节点标准拓扑，近期在节点 7 和节点 22 接入了总容量 1.2MW 的分布式光伏（PV）电源。运行数据显示：
+ 光伏出力波动导致部分节点电压偏差超过 ±5%（如节点 22 电压低至 0.92p.u.，节点 7 电压高至 1.08p.u.）；
+ 光伏出力未被本地负荷充分消纳，导致网损从原始 202kW 升至 235kW，能源浪费严重；
+ 现有拓扑为固定辐射状，无法动态适配光伏出力变化。
**2. 实验目标**
+ 通过粒子群算法（PSO）优化联络开关状态，实现：
+ 核心目标：全网有功网损降至 150kW 以下；
+ 约束条件：所有节点电压在 0.95~1.05p.u. 范围内，无环网、无孤岛；
+ 工程要求：每次重构仅操作 1~2 个联络开关（减少设备损耗）。
## 二、实验前置准备（环境 + 工具）
**1. 安装核心软件**
+ 安装 Python（3.8~3.10 版本，推荐 Anaconda）：Python 官网
+ 安装必要库（打开 cmd / 终端输入命令）：
```python
pip install pandas numpy matplotlib pandapower  # 基础库
pip install pandapower[extra]  # 支持光伏/DG建模
```
**2. 核心工具说明**
+ `pandapower`：配电网建模与潮流计算库（自动处理电网物理公式，无需手动写潮流方程）；
+ `numpy`：处理算法的矩阵 / 向量计算；
+ `matplotlib`：绘制网损曲线、电压分布等结果。

## 三、第一步：配电网物理结构→计算机数据模型（建模核心）
**1. 先看懂 IEEE 33 节点的物理结构（小白必知）**
IEEE 33 节点系统的核心组成（对应现实电网组件）：
物理组件	功能说明	数量（IEEE 33）
电源点（节点 0）	连接上级变电站，提供电压基准（1.0p.u.）	1 个
负荷节点（1-32）	连接居民 / 商业负荷（耗电）	32 个
分段开关支路	常闭，划分线路段落（故障时断开）	32 条（支路 1-32）
联络开关支路	常开，连接不同馈线（重构时操作）	5 条（支路 33-37）

## 四、第二步：电网开关状态→算法编码（核心桥梁）
**1. 明确 “优化变量”：只操作联络开关**
现实中重构很少动分段开关（避免大面积停电），因此仅对 5 个联络开关（支路 33-37）编码，分段开关保持常闭。
**2. 编码方式：二进制编码（小白最易理解）**
+ 编码向量长度 = 联络开关数量 = 5；
+ 向量元素 = 开关状态：0 = 断开，1 = 闭合；
+ 举例：[0,1,0,0,0] → 联络开关 34 闭合，其余 4 个断开。
**3. 编码与开关的映射（代码实现）**
先定义联络开关的索引（在net.line中的位置），建立 “编码位置→实际开关” 的对应：


## 五、第三步：PSO 算法实现（从初始化到迭代）
**1. 算法核心模块拆解**
+ PSO 算法通过 “种群粒子” 搜索最优编码，每个粒子对应一种开关状态组合，核心模块包括：
+ 初始化：生成随机粒子群（开关状态组合）；
+ 适应度计算：计算每个粒子的网损（目标函数值）；
+ 合法性校验：确保拓扑无环、无孤岛；
+ 迭代优化：更新粒子位置（开关状态），寻找最优解。

## 六、第四步：运行实验（代码 + 结果分析）
**1. 执行重构算法**
```python
# 运行PSO重构
最优编码, 最优网损, 迭代记录 = PSO配电网重构(
    net=net,
    联络开关索引=联络开关索引,
    种群大小=50,
    最大迭代=100
)

# 输出核心结果
print("\n=== 重构结果 ===")
print("最优联络开关编码：", 最优编码)
print("重构后最优网损：", 最优网损, "kW")
print("原始网损（联络全断）：", 计算网损(net, [0,0,0,0,0], 联络开关索引), "kW")
```
**2. 结果可视化（直观展示效果）**
**图 1：网损迭代曲线（看算法收敛性）**
```python
plt.figure(figsize=(10,6))
plt.plot(range(len(迭代记录)), 迭代记录, "b-o", linewidth=2)
plt.xlabel("迭代次数", fontsize=12)
plt.ylabel("网损（kW）", fontsize=12)
plt.title("PSO算法网损迭代曲线", fontsize=14)
plt.grid(True)
plt.show()
```

**图 2：节点电压分布（看电压改善效果）**
```python
# 计算重构后的节点电压
for i in range(len(最优编码)):
    开关索引 = 联络开关索引[i]
    net.line["in_service"][开关索引] = (最优编码[i] == 1)
pp.runpp(net)

# 绘制电压曲线
plt.figure(figsize=(12,6))
节点编号 = net.bus.index
电压值 = net.res_bus["vm_pu"]
plt.plot(节点编号, 电压值, "r-o", linewidth=2)
plt.axhline(y=0.95, color="green", linestyle="--", label="电压下限0.95p.u.")
plt.axhline(y=1.05, color="red", linestyle="--", label="电压上限1.05p.u.")
plt.xlabel("节点编号", fontsize=12)
plt.ylabel("节点电压（p.u.）", fontsize=12)
plt.title("重构后节点电压分布", fontsize=14)
plt.legend()
plt.grid(True)
plt.show()
```

## 七、第五步：结果→工程落地（开关操作指令）
**1. 编码→实际开关状态（明确操作对象）**
先建立 “编码位置→联络开关物理编号” 的映射表：
编码位置	联络开关索引（net.line）	物理开关编号	连接节点	重构后状态（最优编码）
0	32	33	节点 7-20	0 = 断开
1	33	34	节点 9-14	1 = 闭合
2	34	35	节点 12-22	0 = 断开
3	35	36	节点 18-33	0 = 断开
4	36	37	节点 25-29	0 = 断开

**2. 工程操作指令（给调度员的具体步骤）**
1. 操作对象：联络开关 34（连接节点 9-14）；
2. 操作步骤：
 + 第一步：检查节点 9 和节点 14 的电压（确保差值 < 0.1p.u.，避免操作冲击）；
 + 第二步：闭合联络开关 34（缓慢操作，监测电流无过负荷）；
 + 第三步：确认拓扑无环（通过 SCADA 系统查看电流方向）；
3. 操作后验证：
 + 网损从 235kW 降至 148kW（降幅 37%）；
 + 节点 22 电压从 0.92p.u. 升至 0.97p.u.（符合标准）。
**3. 工程约束提醒**
+ 开关操作次数：每日不超过 5 次（避免机械损耗）；
+ 光伏出力波动：需每小时重新计算最优解（动态重构）；
+ 故障预案：若联络开关 34 故障，自动切换至联络开关 35 闭合。

## 七、避坑指南（小白必看）
1. 潮流不收敛：
 + 原因：DG 出力过大（如光伏功率超过负荷）；
 + 解决：减小 DG 出力（如从 - 0.6MW 改为 - 0.4MW），或换求解器solver='nrp'。
2. 编码与开关映射错误：
 + 检查联络开关索引是否正确（内置模型通常是最后 5 条支路）；
 + 用print(net.line[["name", "from_bus", "to_bus", "in_service"]])查看支路信息。
2. 算法收敛慢：
 + 增加种群大小（如从 50 增至 80），或调整学习因子c1=1.5, c2=1.5。
## 八、下一步进阶（可选）
+ 多目标优化：同时优化网损 + 电压偏差（加入权重目标=0.7*网损+0.3*电压偏差）；
+ 动态重构：按小时更新光伏出力，每小时运行一次 PSO；
+ 加入储能：用pp.create_storage()添加储能，优化 “重构 + 储能充放电” 联合策略。
